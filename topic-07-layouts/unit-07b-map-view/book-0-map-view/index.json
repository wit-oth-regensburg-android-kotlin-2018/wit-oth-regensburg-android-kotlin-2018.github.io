


  {
  
  
  "type" : "lab",
  "title" : "Lab-07 MapView",
  "folder" : "book-0-map-view",
  
    "link" : "book-0-map-view/index.html",
  
  "img" : "book-0-map-view/img/main.png",
  "videoid" : "none",
  "objectives" : "<p>Display all placemarks on a map in a new activity</p>",
  "properties" : {},
  "los": [  ]
,
  "chapters" : [
  
    {
    "title": "Objectives",
    "shortTitle": "Lab-07 MapView",
    "content": [
     
      "<h1>Objectives</h1>" ,
     
      "<p>Display all placemarks on a map in a new activity</p>" ,
     
      "" 
     
    ]
    },
  
    {
    "title": " Exercises",
    "shortTitle": "01",
    "content": [
     
      "<h1>Exercises</h1>" ,
     
      "<h2>Exercise 1</h2>" ,
     
      "<p>Change back to using the PlacemarkMemStore instead of PlacemarkJSONStore. The only change you need to make should be in MainApp.</p>" ,
     
      "<p>Try some experiments to make sure the persistence is working as expected:</p>" ,
     
      "<ul>" ,
     
      "<li>Using MemStore - create some placemarks and then kill the app. Relaunch, and verify that all placemarks are gone</li>" ,
     
      "<li>Using JsonStore - try the same experiment. This time the placemarks should persist between application terminations.</li>" ,
     
      "</ul>" ,
     
      "<h3>Exercise 1 Solution</h3>" ,
     
      "<p>To switch between the database and memory stores - it should be just a matter of commenting out one of the placemarks declarations:</p>" ,
     
      "<h3>Using Json</h3>" ,
     
      "<pre><code>   // placemarks = PlacemarkMemStore()" ,
     
      "    placemarks = PlacemarkJSONStore(applicationContext)</code></pre>" ,
     
      "<h3>Using memory:</h3>" ,
     
      "<pre><code>    placemarks = PlacemarkMemStore()" ,
     
      "    // placemarks = PlacemarkJSONStore(applicationContext)</code></pre>" ,
     
      "<h2>Exercise 2: PlacemarkJSONStore update method</h2>" ,
     
      "<p>Complete the implementation of the update method in the PlacemarkJSONStore class. Use the corresponding method in PlacemarkMemStore as a guide (and dont forget to save changes to the file).</p>" ,
     
      "<h2>Exercise 2 Solution:</h2>" ,
     
      "<h2>PlacemarkJSONStore</h2>" ,
     
      "<pre><code>  override fun update(placemark: PlacemarkModel) {" ,
     
      "    val placemarksList = findAll() as ArrayList&lt;PlacemarkModel&gt;" ,
     
      "    var foundPlacemark: PlacemarkModel? = placemarksList.find { p -&gt; p.id == placemark.id }" ,
     
      "    if (foundPlacemark != null) {" ,
     
      "      foundPlacemark.title = placemark.title" ,
     
      "      foundPlacemark.description = placemark.description" ,
     
      "      foundPlacemark.image = placemark.image" ,
     
      "      foundPlacemark.lat = placemark.lat" ,
     
      "      foundPlacemark.lng = placemark.lng" ,
     
      "      foundPlacemark.zoom = placemark.zoom" ,
     
      "    }" ,
     
      "    serialize()" ,
     
      "  }</code></pre>" ,
     
      "<h2>Exercise 3</h2>" ,
     
      "<p>Currently we have no way of deleting placemarks. To support delete, you will need to extend the PlacemarkStore to support removal of placemarks, and then implement this in PlacemarkMemStore and PlacemarkJSONStore These are the implementations you will need:</p>" ,
     
      "<h2>PlacemarkStore</h2>" ,
     
      "<pre><code>  fun delete(placemark: PlacemarkModel)</code></pre>" ,
     
      "<p>Introduce this to PlacemarkStore now - and write implementations in <code>PlacemarkMemStore</code> and <code>PlacemarkJSONStore</code> classes :</p>" ,
     
      "<h2>PlacemarkMemStore</h2>" ,
     
      "<pre><code>  override fun delete(placemark: PlacemarkModel) {" ,
     
      "    placemarks.remove(placemark)" ,
     
      "  }</code></pre>" ,
     
      "<h2>PlacemaekJSONStore</h2>" ,
     
      "<pre><code>  override fun delete(placemark: PlacemarkModel) {" ,
     
      "    placemarks.remove(placemark)" ,
     
      "    serialize()" ,
     
      "  }</code></pre>" ,
     
      "<p>To trigger the actual deletion introduce a new <code>delete</code> button alongside the <code>cancel</code> button on the PlacemarkActivity. Pressing this button should trigger the delete method.</p>" ,
     
      "<h2>Exercise 3 Solution</h2>" ,
     
      "<p>Make the above change to the model classes. Then, introduce the delete string resource + button:</p>" ,
     
      "<h2>strings.xml</h2>" ,
     
      "<pre><code>  &lt;string name=&quot;menu_deletePlacemark&quot;&gt;Delete&lt;/string&gt;</code></pre>" ,
     
      "<h2>menu_placemark.xml</h2>" ,
     
      "<pre><code>&lt;?xml version=&quot;1.0&quot; encoding=&quot;utf-8&quot;?&gt;" ,
     
      "&lt;menu xmlns:android=&quot;http://schemas.android.com/apk/res/android&quot;" ,
     
      "  xmlns:app=&quot;http://schemas.android.com/apk/res-auto&quot;&gt;" ,
     
      "" ,
     
      "  &lt;item" ,
     
      "    android:id=&quot;@+id/item_delete&quot;" ,
     
      "    android:title=&quot;@string/menu_deletePlacemark&quot;" ,
     
      "    app:showAsAction=&quot;always&quot;/&gt;" ,
     
      "  &lt;item" ,
     
      "    android:id=&quot;@+id/item_cancel&quot;" ,
     
      "    android:title=&quot;@string/menu_cancelPlacemark&quot;" ,
     
      "    app:showAsAction=&quot;always&quot;/&gt;" ,
     
      "&lt;/menu&gt;</code></pre>" ,
     
      "<p>The menu event handler can then be extended to trigger delete:</p>" ,
     
      "<h2>PlacemarkActivity</h2>" ,
     
      "<pre><code>  override fun onOptionsItemSelected(item: MenuItem?): Boolean {" ,
     
      "    when (item?.itemId) {" ,
     
      "      R.id.item_delete -&gt; {" ,
     
      "        app.placemarks.delete(placemark)" ,
     
      "        finish()" ,
     
      "      }" ,
     
      "      R.id.item_cancel -&gt; {" ,
     
      "        finish()" ,
     
      "      }" ,
     
      "    }" ,
     
      "    return super.onOptionsItemSelected(item)" ,
     
      "  }</code></pre>" ,
     
      "<p>Try this now and verify that to works as expected.</p>" ,
     
      "<p>Finally - notice that the delete button is always visible - even if we are creating a new placemark (cancel is sufficient in this circumstance).</p>" ,
     
      "<p>To make the appearance of the button conditional, make the following changes:</p>" ,
     
      "<p>First, make the delete option invisible by default:</p>" ,
     
      "<pre><code>  &lt;item" ,
     
      "    android:visible=&quot;false&quot;" ,
     
      "    android:id=&quot;@+id/item_delete&quot;" ,
     
      "    android:title=&quot;@string/menu_deletePlacemark&quot;" ,
     
      "    app:showAsAction=&quot;always&quot;/&gt;</code></pre>" ,
     
      "<p>Make the edit flag in PlacemarkActivity  a class member, not a local variable:</p>" ,
     
      "<h2>PlacemarkActivity</h2>" ,
     
      "<pre><code>class PlacemarkActivity : AppCompatActivity(), AnkoLogger {" ,
     
      "  //" ,
     
      "  var edit = false;" ,
     
      "" ,
     
      "" ,
     
      "  ..." ,
     
      "   override fun onCreate(savedInstanceState: Bundle?) {" ,
     
      "     ..." ,
     
      "        edit = true" ,
     
      "     ...</code></pre>" ,
     
      "<p>Then, we check this flag when inflating the menu, and display delete if we are in edit mode:</p>" ,
     
      "<pre><code>  override fun onCreateOptionsMenu(menu: Menu?): Boolean {" ,
     
      "    menuInflater.inflate(R.menu.menu_placemark, menu)" ,
     
      "    if (edit &amp;&amp; menu != null) menu.getItem(0).setVisible(true)" ,
     
      "    return super.onCreateOptionsMenu(menu)" ,
     
      "  }</code></pre>" ,
     
      "<p>Try this now.</p>" ,
     
      "" 
     
    ]
    },
  
    {
    "title": " PlacemarkMapsActivity",
    "shortTitle": "02",
    "content": [
     
      "<h1>PlacemarkMapsActivity</h1>" ,
     
      "<p>We would like a new activity to show all placemarks in our collection. This should be activated by a new menu option.</p>" ,
     
      "<h2>Menu</h2>" ,
     
      "<p>Create a new menu option in the <code>main_menu.xml</code>:</p>" ,
     
      "<h2>res/menu/menu_main.xml</h2>" ,
     
      "<pre><code>&lt;?xml version=&quot;1.0&quot; encoding=&quot;utf-8&quot;?&gt;" ,
     
      "&lt;menu xmlns:android=&quot;http://schemas.android.com/apk/res/android&quot;" ,
     
      "      xmlns:app=&quot;http://schemas.android.com/apk/res-auto&quot;&gt;" ,
     
      "" ,
     
      "  &lt;item" ,
     
      "    android:id=&quot;@+id/item_add&quot;" ,
     
      "    android:icon=&quot;@android:drawable/ic_menu_add&quot;" ,
     
      "    android:title=&quot;@string/menu_addPlacemark&quot;" ,
     
      "    app:showAsAction=&quot;always&quot;/&gt;" ,
     
      "" ,
     
      "  &lt;item" ,
     
      "      android:id=&quot;@+id/item_map&quot;" ,
     
      "      android:icon=&quot;@android:drawable/ic_menu_mapmode&quot;" ,
     
      "      android:title=&quot;@string/menu_addPlacemark&quot;" ,
     
      "      app:showAsAction=&quot;always&quot;/&gt;" ,
     
      "&lt;/menu&gt;</code></pre>" ,
     
      "<p>We have just duplicated the add item - and given it the id <code>item_map</code> and the icon <code>ic_menu_mapmode</code>. It should look like this in the layout editor:</p>" ,
     
      "<p><img src='img/02.png' alt=''></p>" ,
     
      "<h2>PlacemarkMapsActivity</h2>" ,
     
      "<p>Now use the wizard in Android to generate a new <code>Basic</code> activity call PlacemarkMapsActivity</p>" ,
     
      "<p><img src='img/01.png' alt=''></p>" ,
     
      "<p>Accepting the defaults as shown above - your application will have the following class automatically generated by the wizard:</p>" ,
     
      "<pre><code>package org.wit.placemark.activities" ,
     
      "" ,
     
      "import android.os.Bundle" ,
     
      "import android.support.design.widget.Snackbar" ,
     
      "import android.support.v7.app.AppCompatActivity" ,
     
      "import org.wit.placemark.R" ,
     
      "" ,
     
      "import kotlinx.android.synthetic.main.activity_placemark_maps.*" ,
     
      "" ,
     
      "class PlacemarkMapsActivity : AppCompatActivity() {" ,
     
      "" ,
     
      "  override fun onCreate(savedInstanceState: Bundle?) {" ,
     
      "    super.onCreate(savedInstanceState)" ,
     
      "    setContentView(R.layout.activity_placemark_maps)" ,
     
      "    setSupportActionBar(toolbar)" ,
     
      "" ,
     
      "    fab.setOnClickListener { view -&gt;" ,
     
      "      Snackbar.make(view, &quot;Replace with your own action&quot;, Snackbar.LENGTH_LONG)" ,
     
      "          .setAction(&quot;Action&quot;, null).show()" ,
     
      "    }" ,
     
      "  }" ,
     
      "" ,
     
      "}</code></pre>" ,
     
      "<h2>res/layout/activity_placemark_maps.xml</h2>" ,
     
      "<pre><code>&lt;?xml version=&quot;1.0&quot; encoding=&quot;utf-8&quot;?&gt;" ,
     
      "&lt;android.support.design.widget.CoordinatorLayout xmlns:android=&quot;http://schemas.android.com/apk/res/android&quot;" ,
     
      "  xmlns:app=&quot;http://schemas.android.com/apk/res-auto&quot;" ,
     
      "  xmlns:tools=&quot;http://schemas.android.com/tools&quot;" ,
     
      "  android:layout_width=&quot;match_parent&quot;" ,
     
      "  android:layout_height=&quot;match_parent&quot;" ,
     
      "  tools:context=&quot;org.wit.placemark.activities.PlacemarkMapsActivity&quot;&gt;" ,
     
      "" ,
     
      "  &lt;android.support.design.widget.AppBarLayout" ,
     
      "    android:layout_width=&quot;match_parent&quot;" ,
     
      "    android:layout_height=&quot;wrap_content&quot;" ,
     
      "    android:theme=&quot;@style/AppTheme.AppBarOverlay&quot;&gt;" ,
     
      "" ,
     
      "    &lt;android.support.v7.widget.Toolbar" ,
     
      "      android:id=&quot;@+id/toolbar&quot;" ,
     
      "      android:layout_width=&quot;match_parent&quot;" ,
     
      "      android:layout_height=&quot;?attr/actionBarSize&quot;" ,
     
      "      android:background=&quot;?attr/colorPrimary&quot;" ,
     
      "      app:popupTheme=&quot;@style/AppTheme.PopupOverlay&quot; /&gt;" ,
     
      "" ,
     
      "  &lt;/android.support.design.widget.AppBarLayout&gt;" ,
     
      "" ,
     
      "  &lt;include layout=&quot;@layout/content_placemark_maps&quot; /&gt;" ,
     
      "" ,
     
      "  &lt;android.support.design.widget.FloatingActionButton" ,
     
      "    android:id=&quot;@+id/fab&quot;" ,
     
      "    android:layout_width=&quot;wrap_content&quot;" ,
     
      "    android:layout_height=&quot;wrap_content&quot;" ,
     
      "    android:layout_gravity=&quot;bottom|end&quot;" ,
     
      "    android:layout_margin=&quot;@dimen/fab_margin&quot;" ,
     
      "    app:srcCompat=&quot;@android:drawable/ic_dialog_email&quot; /&gt;" ,
     
      "" ,
     
      "&lt;/android.support.design.widget.CoordinatorLayout&gt;</code></pre>" ,
     
      "<h2>res/layout/content_placemark_maps.xml</h2>" ,
     
      "<pre><code>&lt;?xml version=&quot;1.0&quot; encoding=&quot;utf-8&quot;?&gt;" ,
     
      "&lt;android.support.constraint.ConstraintLayout xmlns:android=&quot;http://schemas.android.com/apk/res/android&quot;" ,
     
      "  xmlns:app=&quot;http://schemas.android.com/apk/res-auto&quot;" ,
     
      "  xmlns:tools=&quot;http://schemas.android.com/tools&quot;" ,
     
      "  android:layout_width=&quot;match_parent&quot;" ,
     
      "  android:layout_height=&quot;match_parent&quot;" ,
     
      "  app:layout_behavior=&quot;@string/appbar_scrolling_view_behavior&quot;" ,
     
      "  tools:context=&quot;org.wit.placemark.activities.PlacemarkMapsActivity&quot;" ,
     
      "  tools:showIn=&quot;@layout/activity_placemark_maps&quot;&gt;" ,
     
      "" ,
     
      "&lt;/android.support.constraint.ConstraintLayout&gt;</code></pre>" ,
     
      "<h2>res/values/strings</h2>" ,
     
      "<pre><code>  &lt;string name=&quot;title_activity_placemark_maps&quot;&gt;PlacemarkMapsActivity&lt;/string&gt;</code></pre>" ,
     
      "<h2>AndroidManifest.xml</h2>" ,
     
      "<pre><code>    &lt;activity" ,
     
      "      android:name=&quot;.activities.PlacemarkMapsActivity&quot;" ,
     
      "      android:label=&quot;@string/title_activity_placemark_maps&quot;" ,
     
      "      android:theme=&quot;@style/AppTheme&quot;&gt;&lt;/activity&gt;</code></pre>" ,
     
      "<h2>res/values/styles.xml</h2>" ,
     
      "<pre><code>  &lt;style name=&quot;AppTheme.AppBarOverlay&quot; parent=&quot;ThemeOverlay.AppCompat.Dark.ActionBar&quot; /&gt;" ,
     
      "" ,
     
      "  &lt;style name=&quot;AppTheme.PopupOverlay&quot; parent=&quot;ThemeOverlay.AppCompat.Light&quot; /&gt;</code></pre>" ,
     
      "<h2>res/values/dimens.xml</h2>" ,
     
      "<pre><code>&lt;resources&gt;" ,
     
      "  &lt;dimen name=&quot;fab_margin&quot;&gt;16dp&lt;/dimen&gt;" ,
     
      "&lt;/resources&gt;</code></pre>" ,
     
      "<p>Inspect all of these additions - and make suer you have a good idea of the role and purpose of each.</p>" ,
     
      "<p><img src='img/03.png' alt=''></p>" ,
     
      "<p>In PlacemarkListActivity - we can extend the existing menu handler to now also launch this new activity:</p>" ,
     
      "<h2>PlacemarkListActivity</h2>" ,
     
      "<pre><code>  override fun onOptionsItemSelected(item: MenuItem?): Boolean {" ,
     
      "    when (item?.itemId) {" ,
     
      "      R.id.item_add -&gt; startActivityForResult&lt;PlacemarkActivity&gt;(200)" ,
     
      "      R.id.item_map -&gt; startActivity&lt;PlacemarkMapsActivity&gt;()" ,
     
      "    }" ,
     
      "    return super.onOptionsItemSelected(item)" ,
     
      "  }</code></pre>" ,
     
      "<p>When the new menu is selected - you will get a (blank) new activity:</p>" ,
     
      "<p><img src='img/04.png' alt=''></p>" ,
     
      "" 
     
    ]
    },
  
    {
    "title": " Simplify PlacemarkMapsActivity",
    "shortTitle": "03",
    "content": [
     
      "<h1>Simplify PlacemarkMapsActivity</h1>" ,
     
      "<p>The wizards in Studio often generate additional options and code that is not really appropriate depending on the app you are building.</p>" ,
     
      "<p>Modify the layout to have an app bar similar to the other activities:</p>" ,
     
      "<h2>activity_placemark_maps.xml</h2>" ,
     
      "<pre><code>&lt;?xml version=&quot;1.0&quot; encoding=&quot;utf-8&quot;?&gt;" ,
     
      "&lt;android.support.design.widget.CoordinatorLayout xmlns:android=&quot;http://schemas.android.com/apk/res/android&quot;" ,
     
      "  xmlns:app=&quot;http://schemas.android.com/apk/res-auto&quot;" ,
     
      "  xmlns:tools=&quot;http://schemas.android.com/tools&quot;" ,
     
      "  android:layout_width=&quot;match_parent&quot;" ,
     
      "  android:layout_height=&quot;match_parent&quot;" ,
     
      "  tools:context=&quot;org.wit.placemark.activities.PlacemarkMapsActivity&quot;&gt;" ,
     
      "" ,
     
      "  &lt;android.support.design.widget.AppBarLayout" ,
     
      "    android:layout_width=&quot;match_parent&quot;" ,
     
      "    android:layout_height=&quot;wrap_content&quot;" ,
     
      "    android:background=&quot;@color/colorAccent&quot;" ,
     
      "    android:fitsSystemWindows=&quot;true&quot;" ,
     
      "    app:elevation=&quot;0dip&quot;" ,
     
      "    app:theme=&quot;@style/ThemeOverlay.AppCompat.Dark.ActionBar&quot;&gt;" ,
     
      "" ,
     
      "    &lt;android.support.v7.widget.Toolbar" ,
     
      "      android:id=&quot;@+id/toolbarMaps&quot;" ,
     
      "      android:layout_width=&quot;match_parent&quot;" ,
     
      "      android:layout_height=&quot;wrap_content&quot;" ,
     
      "      app:titleTextColor=&quot;@color/colorPrimary&quot;/&gt;" ,
     
      "" ,
     
      "  &lt;/android.support.design.widget.AppBarLayout&gt;" ,
     
      "" ,
     
      "  &lt;include layout=&quot;@layout/content_placemark_maps&quot; /&gt;" ,
     
      "" ,
     
      "&lt;/android.support.design.widget.CoordinatorLayout&gt;</code></pre>" ,
     
      "<p>Simplify PlacemarkMapsActivity now to the following:</p>" ,
     
      "<h2>PlacemarkMapsActivity</h2>" ,
     
      "<pre><code>package org.wit.placemark.activities" ,
     
      "" ,
     
      "import android.os.Bundle" ,
     
      "import android.support.v7.app.AppCompatActivity" ,
     
      "import org.wit.placemark.R" ,
     
      "import kotlinx.android.synthetic.main.activity_placemark_maps.*" ,
     
      "" ,
     
      "class PlacemarkMapsActivity : AppCompatActivity() {" ,
     
      "" ,
     
      "  override fun onCreate(savedInstanceState: Bundle?) {" ,
     
      "    super.onCreate(savedInstanceState)" ,
     
      "    setContentView(R.layout.activity_placemark_maps)" ,
     
      "    setSupportActionBar(toolbarMaps)" ,
     
      "  }" ,
     
      "}</code></pre>" ,
     
      "<p>Finally, change the generated title:</p>" ,
     
      "<h2>res/values/strings.xml</h2>" ,
     
      "<pre><code>  &lt;string name=&quot;title_activity_placemark_maps&quot;&gt;Map of All Placemarks &lt;/string&gt;</code></pre>" ,
     
      "<p>Our new view will be a single map showing all of the placemarks we have set. We develop this in the next steps.</p>" ,
     
      "" 
     
    ]
    },
  
    {
    "title": " content_placemark_maps",
    "shortTitle": "04",
    "content": [
     
      "<h1>content_placemark_maps</h1>" ,
     
      "<p>Notice that the wizard generated 2 layouts:</p>" ,
     
      "<ul>" ,
     
      "<li>activity_placemark_maps.xml</li>" ,
     
      "<li>content_placemark_maps</li>" ,
     
      "</ul>" ,
     
      "<p>The latter is a blank canvas - based on the ConstraintLayout - which we will now use to design our view.</p>" ,
     
      "<p><img src='img/05.png' alt=''></p>" ,
     
      "<p>First - drag and drop a <code>CardView</code> component onto the canvas:</p>" ,
     
      "<p><img src='img/06.png' alt=''></p>" ,
     
      "<p>Then resize it something like this:</p>" ,
     
      "<p><img src='img/07.png' alt=''></p>" ,
     
      "<p>Then anchor three of its sides to the edge of the view:</p>" ,
     
      "<p><img src='img/08.png' alt=''></p>" ,
     
      "<p>You do this by selecting each of the circle anchor points and then clicking on the appropriate edge.</p>" ,
     
      "<p>Now drag a MapView onto the canvas - and do the same anchoring procedure:</p>" ,
     
      "<p><img src='img/09.png' alt=''></p>" ,
     
      "<p>Be sure to attach the bottom of the Map to the top of the Card:</p>" ,
     
      "<p><img src='img/11.png' alt=''></p>" ,
     
      "<p>Run the app now - you should see something like this:</p>" ,
     
      "<p><img src='img/10.png' alt=''></p>" ,
     
      "<p>This is the layout at this stage:</p>" ,
     
      "<h2>res/content_placemark_maps.xml</h2>" ,
     
      "<pre><code>&lt;?xml version=&quot;1.0&quot; encoding=&quot;utf-8&quot;?&gt;" ,
     
      "&lt;android.support.constraint.ConstraintLayout xmlns:android=&quot;http://schemas.android.com/apk/res/android&quot;" ,
     
      "  xmlns:app=&quot;http://schemas.android.com/apk/res-auto&quot;" ,
     
      "  xmlns:tools=&quot;http://schemas.android.com/tools&quot;" ,
     
      "  android:layout_width=&quot;match_parent&quot;" ,
     
      "  android:layout_height=&quot;match_parent&quot;" ,
     
      "  app:layout_behavior=&quot;@string/appbar_scrolling_view_behavior&quot;" ,
     
      "  tools:context=&quot;org.wit.placemark.activities.PlacemarkMapsActivity&quot;" ,
     
      "  tools:showIn=&quot;@layout/activity_placemark_maps&quot;&gt;" ,
     
      "" ,
     
      "  &lt;android.support.v7.widget.CardView" ,
     
      "    android:id=&quot;@+id/cardView&quot;" ,
     
      "    android:layout_width=&quot;353dp&quot;" ,
     
      "    android:layout_height=&quot;114dp&quot;" ,
     
      "    android:layout_marginBottom=&quot;16dp&quot;" ,
     
      "    android:layout_marginEnd=&quot;8dp&quot;" ,
     
      "    android:layout_marginStart=&quot;8dp&quot;" ,
     
      "    app:layout_constraintBottom_toBottomOf=&quot;parent&quot;" ,
     
      "    app:layout_constraintEnd_toEndOf=&quot;parent&quot;" ,
     
      "    app:layout_constraintHorizontal_bias=&quot;0.533&quot;" ,
     
      "    app:layout_constraintStart_toStartOf=&quot;parent&quot; /&gt;" ,
     
      "" ,
     
      "  &lt;com.google.android.gms.maps.MapView" ,
     
      "    android:id=&quot;@+id/mapView&quot;" ,
     
      "    android:layout_width=&quot;352dp&quot;" ,
     
      "    android:layout_height=&quot;348dp&quot;" ,
     
      "    android:layout_marginBottom=&quot;8dp&quot;" ,
     
      "    android:layout_marginEnd=&quot;8dp&quot;" ,
     
      "    android:layout_marginStart=&quot;8dp&quot;" ,
     
      "    android:layout_marginTop=&quot;8dp&quot;" ,
     
      "    app:layout_constraintBottom_toTopOf=&quot;@+id/cardView&quot;" ,
     
      "    app:layout_constraintEnd_toEndOf=&quot;parent&quot;" ,
     
      "    app:layout_constraintStart_toStartOf=&quot;parent&quot;" ,
     
      "    app:layout_constraintTop_toTopOf=&quot;parent&quot; /&gt;" ,
     
      "&lt;/android.support.constraint.ConstraintLayout&gt;</code></pre>" ,
     
      "<p>Now we can bring in a new attribute into the PlacemarkMapsActivity for the map object we just introduced:</p>" ,
     
      "<h2>PlacemarkMapsActivity</h2>" ,
     
      "<pre><code>package org.wit.placemark.activities" ,
     
      "" ,
     
      "import android.os.Bundle" ,
     
      "import android.support.v7.app.AppCompatActivity" ,
     
      "import com.google.android.gms.maps.GoogleMap" ,
     
      "import org.wit.placemark.R" ,
     
      "import kotlinx.android.synthetic.main.activity_placemark_maps.*" ,
     
      "import kotlinx.android.synthetic.main.content_placemark_maps.*" ,
     
      "" ,
     
      "class PlacemarkMapsActivity : AppCompatActivity() {" ,
     
      "" ,
     
      "  lateinit var map: GoogleMap" ,
     
      "" ,
     
      "  override fun onCreate(savedInstanceState: Bundle?) {" ,
     
      "    super.onCreate(savedInstanceState)" ,
     
      "    setContentView(R.layout.activity_placemark_maps)" ,
     
      "    setSupportActionBar(toolbarMaps)" ,
     
      "    mapView.onCreate(savedInstanceState);" ,
     
      "  }" ,
     
      "}</code></pre>" ,
     
      "<p>Notice we are calling <code>mapView.onCreate</code>. This should now display the (empty) map:</p>" ,
     
      "<p><img src='img/12.png' alt=''></p>" ,
     
      "<p>To make the map actually render correctly - we need to rework the class so that we are passing the lifecycle events on to the map from PlacemarkMapsActivity:</p>" ,
     
      "<h2>PlacemarkMapsActivity</h2>" ,
     
      "<pre><code>package org.wit.placemark.activities" ,
     
      "" ,
     
      "import android.os.Bundle" ,
     
      "import android.support.v7.app.AppCompatActivity" ,
     
      "import com.google.android.gms.maps.GoogleMap" ,
     
      "import org.wit.placemark.R" ,
     
      "import kotlinx.android.synthetic.main.activity_placemark_maps.*" ,
     
      "import kotlinx.android.synthetic.main.content_placemark_maps.*" ,
     
      "" ,
     
      "class PlacemarkMapsActivity : AppCompatActivity() {" ,
     
      "" ,
     
      "  lateinit var map: GoogleMap" ,
     
      "" ,
     
      "  override fun onCreate(savedInstanceState: Bundle?) {" ,
     
      "    super.onCreate(savedInstanceState)" ,
     
      "    setContentView(R.layout.activity_placemark_maps)" ,
     
      "    setSupportActionBar(toolbarMaps)" ,
     
      "    mapView.onCreate(savedInstanceState);" ,
     
      "  }" ,
     
      "" ,
     
      "  override fun onDestroy() {" ,
     
      "    super.onDestroy()" ,
     
      "    mapView.onDestroy()" ,
     
      "  }" ,
     
      "" ,
     
      "  override fun onLowMemory() {" ,
     
      "    super.onLowMemory()" ,
     
      "    mapView.onLowMemory()" ,
     
      "  }" ,
     
      "" ,
     
      "  override fun onPause() {" ,
     
      "    super.onPause()" ,
     
      "    mapView.onPause()" ,
     
      "  }" ,
     
      "" ,
     
      "  override fun onResume() {" ,
     
      "    super.onResume()" ,
     
      "    mapView.onResume()" ,
     
      "  }" ,
     
      "" ,
     
      "  override fun onSaveInstanceState(outState: Bundle?) {" ,
     
      "    super.onSaveInstanceState(outState)" ,
     
      "    mapView.onSaveInstanceState(outState)" ,
     
      "  }" ,
     
      "}</code></pre>" ,
     
      "<p>The map should now display correctly:</p>" ,
     
      "<p><img src='img/13.png' alt=''></p>" ,
     
      "" 
     
    ]
    },
  
    {
    "title": " Markers",
    "shortTitle": "05",
    "content": [
     
      "<h1>Markers</h1>" ,
     
      "<p>Currently our new view looks like this:</p>" ,
     
      "<p><img src='img/14.png' alt=''></p>" ,
     
      "<p>We can start to configure the map but introducing a new method to for this purpose:</p>" ,
     
      "<h2>PlacemarkMapsActivity</h2>" ,
     
      "<pre><code>  fun configureMap() {" ,
     
      "    map.uiSettings.setZoomControlsEnabled(true)" ,
     
      "  }</code></pre>" ,
     
      "<p>To call this method, we need to first initialize the map object - and then call configureMap()</p>" ,
     
      "<h2>PlacemarkMapsActivity</h2>" ,
     
      "<pre><code>  override fun onCreate(savedInstanceState: Bundle?) {" ,
     
      "    super.onCreate(savedInstanceState)" ,
     
      "    setContentView(R.layout.activity_placemark_maps)" ,
     
      "    setSupportActionBar(toolbarMaps)" ,
     
      "    mapView.onCreate(savedInstanceState);" ,
     
      "    mapView.getMapAsync {" ,
     
      "      map = it" ,
     
      "      configureMap()" ,
     
      "    }" ,
     
      "  }</code></pre>" ,
     
      "<p>Note carefully the last three lines above - we are asking the MapView for the actual googleMap object (called <code>it</code> in this shorthand above). We then store <code>it</code> in the <code>map</code> property of the class.</p>" ,
     
      "<p>Running the app - you should see new zoom controls:</p>" ,
     
      "<p><img src='img/14.png' alt=''></p>" ,
     
      "<p>Now bring in a reference to the <code>MainApp</code> object into the class</p>" ,
     
      "<h2>PlacemarkMapsActivity</h2>" ,
     
      "<pre><code>class PlacemarkMapsActivity : AppCompatActivity() {" ,
     
      "  ..." ,
     
      "  lateinit var app: MainApp" ,
     
      "" ,
     
      "  override fun onCreate(savedInstanceState: Bundle?) {" ,
     
      "    ..." ,
     
      "    app = application as MainApp" ,
     
      "    ..." ,
     
      "  }</code></pre>" ,
     
      "<p>Notice it is also initialize above in the usual manner.</p>" ,
     
      "<p>Now rework condigureMap to iterate through all of the placemarks (fetched from the store) and add a marker at the location of each of them.</p>" ,
     
      "<pre><code>  fun configureMap() {" ,
     
      "    map.uiSettings.setZoomControlsEnabled(true)" ,
     
      "    app.placemarks.findAll().forEach {" ,
     
      "      val loc = LatLng(it.lat, it.lng)" ,
     
      "      val options = MarkerOptions().title(it.title).position(loc)" ,
     
      "      map.addMarker(options).tag = it.id" ,
     
      "    }" ,
     
      "  }</code></pre>" ,
     
      "<p>Run the app now and create a few placemarks in different locations. Then display this activity - we expect to see markers in the correct locations (we may need to zoom in to see them).</p>" ,
     
      "<p>If we add the following to the loop:</p>" ,
     
      "<pre><code>        map.moveCamera(CameraUpdateFactory.newLatLngZoom(loc, it.zoom))</code></pre>" ,
     
      "<p>Then the app should zoom in to the last placemark:</p>" ,
     
      "<p><img src='img/18.png' alt=''></p>" ,
     
      "<p>This is the complete configureMap method at this stage:</p>" ,
     
      "<pre><code>  fun configureMap() {" ,
     
      "    map.uiSettings.setZoomControlsEnabled(true)" ,
     
      "    app.placemarks.findAll().forEach {" ,
     
      "      val loc = LatLng(it.lat, it.lng)" ,
     
      "      val options = MarkerOptions().title(it.title).position(loc)" ,
     
      "      map.addMarker(options).tag = it.id" ,
     
      "      map.moveCamera(CameraUpdateFactory.newLatLngZoom(loc, it.zoom))" ,
     
      "    }" ,
     
      "  }</code></pre>" ,
     
      "" 
     
    ]
    },
  
    {
    "title": " CardView",
    "shortTitle": "06",
    "content": [
     
      "<h1>CardView</h1>" ,
     
      "<p>We already have a CardView in place. We now start to work inside it. First, install a ConstraintLayout inside the Card:</p>" ,
     
      "<p><img src='img/19.png' alt=''></p>" ,
     
      "<p>Then, insert an ImageView:</p>" ,
     
      "<p><img src='img/20.png' alt=''></p>" ,
     
      "<p>and 2 TextViews into the card:</p>" ,
     
      "<p><img src='img/21.png' alt=''></p>" ,
     
      "<p>Call the TextViews <code>currentTitle</code> and <code>currentDescription</code> respectively.</p>" ,
     
      "<p>Anchor them as shown below:</p>" ,
     
      "<p><img src='img/22.png' alt=''></p>" ,
     
      "<p>This is the complete layout at this stage:</p>" ,
     
      "<pre><code>&lt;?xml version=&quot;1.0&quot; encoding=&quot;utf-8&quot;?&gt;" ,
     
      "&lt;android.support.constraint.ConstraintLayout xmlns:android=&quot;http://schemas.android.com/apk/res/android&quot;" ,
     
      "  xmlns:app=&quot;http://schemas.android.com/apk/res-auto&quot;" ,
     
      "  xmlns:tools=&quot;http://schemas.android.com/tools&quot;" ,
     
      "  android:layout_width=&quot;match_parent&quot;" ,
     
      "  android:layout_height=&quot;match_parent&quot;" ,
     
      "  app:layout_behavior=&quot;@string/appbar_scrolling_view_behavior&quot;" ,
     
      "  tools:context=&quot;org.wit.placemark.activities.PlacemarkMapsActivity&quot;" ,
     
      "  tools:showIn=&quot;@layout/activity_placemark_maps&quot;&gt;" ,
     
      "" ,
     
      "  &lt;android.support.v7.widget.CardView" ,
     
      "    android:id=&quot;@+id/cardView&quot;" ,
     
      "    android:layout_width=&quot;353dp&quot;" ,
     
      "    android:layout_height=&quot;114dp&quot;" ,
     
      "    android:layout_marginBottom=&quot;16dp&quot;" ,
     
      "    android:layout_marginEnd=&quot;8dp&quot;" ,
     
      "    android:layout_marginStart=&quot;8dp&quot;" ,
     
      "    app:layout_constraintBottom_toBottomOf=&quot;parent&quot;" ,
     
      "    app:layout_constraintEnd_toEndOf=&quot;parent&quot;" ,
     
      "    app:layout_constraintHorizontal_bias=&quot;0.533&quot;" ,
     
      "    app:layout_constraintStart_toStartOf=&quot;parent&quot; &gt;" ,
     
      "" ,
     
      "    &lt;android.support.constraint.ConstraintLayout" ,
     
      "      android:layout_width=&quot;match_parent&quot;" ,
     
      "      android:layout_height=&quot;match_parent&quot;&gt;" ,
     
      "" ,
     
      "      &lt;TextView" ,
     
      "        android:id=&quot;@+id/currentTitle&quot;" ,
     
      "        android:layout_width=&quot;135dp&quot;" ,
     
      "        android:layout_height=&quot;25dp&quot;" ,
     
      "        android:layout_marginEnd=&quot;8dp&quot;" ,
     
      "        android:layout_marginStart=&quot;8dp&quot;" ,
     
      "        android:layout_marginTop=&quot;20dp&quot;" ,
     
      "        app:layout_constraintEnd_toStartOf=&quot;@+id/imageView&quot;" ,
     
      "        app:layout_constraintHorizontal_bias=&quot;0.35&quot;" ,
     
      "        app:layout_constraintStart_toStartOf=&quot;parent&quot;" ,
     
      "        app:layout_constraintTop_toTopOf=&quot;parent&quot; /&gt;" ,
     
      "" ,
     
      "      &lt;TextView" ,
     
      "        android:id=&quot;@+id/currentDescription&quot;" ,
     
      "        android:layout_width=&quot;135dp&quot;" ,
     
      "        android:layout_height=&quot;25dp&quot;" ,
     
      "        android:layout_marginBottom=&quot;8dp&quot;" ,
     
      "        android:layout_marginEnd=&quot;8dp&quot;" ,
     
      "        android:layout_marginStart=&quot;8dp&quot;" ,
     
      "        android:layout_marginTop=&quot;8dp&quot;" ,
     
      "        app:layout_constraintBottom_toBottomOf=&quot;parent&quot;" ,
     
      "        app:layout_constraintEnd_toStartOf=&quot;@+id/imageView&quot;" ,
     
      "        app:layout_constraintHorizontal_bias=&quot;0.35&quot;" ,
     
      "        app:layout_constraintStart_toStartOf=&quot;parent&quot;" ,
     
      "        app:layout_constraintTop_toBottomOf=&quot;@+id/currentTitle&quot;" ,
     
      "        app:layout_constraintVertical_bias=&quot;0.425&quot; /&gt;" ,
     
      "" ,
     
      "      &lt;ImageView" ,
     
      "        android:id=&quot;@+id/imageView&quot;" ,
     
      "        android:layout_width=&quot;134dp&quot;" ,
     
      "        android:layout_height=&quot;70dp&quot;" ,
     
      "        android:layout_marginBottom=&quot;8dp&quot;" ,
     
      "        android:layout_marginEnd=&quot;8dp&quot;" ,
     
      "        android:layout_marginTop=&quot;8dp&quot;" ,
     
      "        app:layout_constraintBottom_toBottomOf=&quot;parent&quot;" ,
     
      "        app:layout_constraintEnd_toEndOf=&quot;parent&quot;" ,
     
      "        app:layout_constraintTop_toTopOf=&quot;parent&quot;" ,
     
      "        app:srcCompat=&quot;@drawable/ic_launcher_background&quot; /&gt;" ,
     
      "    &lt;/android.support.constraint.ConstraintLayout&gt;" ,
     
      "  &lt;/android.support.v7.widget.CardView&gt;" ,
     
      "" ,
     
      "  &lt;com.google.android.gms.maps.MapView" ,
     
      "    android:id=&quot;@+id/mapView&quot;" ,
     
      "    android:layout_width=&quot;352dp&quot;" ,
     
      "    android:layout_height=&quot;348dp&quot;" ,
     
      "    android:layout_marginBottom=&quot;8dp&quot;" ,
     
      "    android:layout_marginEnd=&quot;8dp&quot;" ,
     
      "    android:layout_marginStart=&quot;8dp&quot;" ,
     
      "    android:layout_marginTop=&quot;8dp&quot;" ,
     
      "    app:layout_constraintBottom_toTopOf=&quot;@+id/cardView&quot;" ,
     
      "    app:layout_constraintEnd_toEndOf=&quot;parent&quot;" ,
     
      "    app:layout_constraintStart_toStartOf=&quot;parent&quot;" ,
     
      "    app:layout_constraintTop_toTopOf=&quot;parent&quot; /&gt;" ,
     
      "&lt;/android.support.constraint.ConstraintLayout&gt;</code></pre>" ,
     
      "" 
     
    ]
    },
  
    {
    "title": " Marker Listener",
    "shortTitle": "07",
    "content": [
     
      "<h1>Marker Listener</h1>" ,
     
      "<p>Back in the class, implement the OnMarkerListener interface:</p>" ,
     
      "<h2>PlacemarkMapsActivity</h2>" ,
     
      "<pre><code>class PlacemarkMapsActivity : AppCompatActivity(), GoogleMap.OnMarkerClickListener {</code></pre>" ,
     
      "<p>This is the implementation:</p>" ,
     
      "<pre><code>  override fun onMarkerClick(marker: Marker): Boolean {" ,
     
      "    currentTitle.text = marker.title" ,
     
      "    return false" ,
     
      "  }</code></pre>" ,
     
      "<p>In order to receive events, you will need to register to listen for then. Here is a reworked configureMap to do this:</p>" ,
     
      "<pre><code> fun configureMap() {" ,
     
      "    ..." ,
     
      "    map.setOnMarkerClickListener(this)" ,
     
      "    ..." ,
     
      "  }</code></pre>" ,
     
      "<p>Run the app now - and if you click on a marker, it should display its title in the card:</p>" ,
     
      "<p><img src='img/23.png' alt=''></p>" ,
     
      "" 
     
    ]
    },
  
    {
    "title": "# Solution",
    "shortTitle": "08.Exercises",
    "content": [
     
      "<h2>Solution</h2>" ,
     
      "<p>Placemark application so far:</p>" ,
     
      "<ul>" ,
     
      "<li><a href='archives/placemark-07.zip'>placemark-07.zip</a></li>" ,
     
      "</ul>" ,
     
      "<h2>Exercise 1</h2>" ,
     
      "<p>Currently the PlacemarkActivity layout is hand coded - and is not using the ConstraintLayout. The screen shots below are taken from a refactor the view to make it fully based on the ConstraintLayout. All of this refactoring is carried out using the visual tools.</p>" ,
     
      "<p>See if you can replicate in your project. Keep a close eye on the Component Tree as you work through it.</p>" ,
     
      "<p><img src='img/24.png' alt=''></p>" ,
     
      "<p><img src='img/25.png' alt=''></p>" ,
     
      "<p><img src='img/26.png' alt=''></p>" ,
     
      "<p><img src='img/27.png' alt=''></p>" ,
     
      "<p><img src='img/28.png' alt=''></p>" ,
     
      "<h2>Exercise 2</h2>" ,
     
      "<p>Currently, when you select the marker in the PlacemarkMapsActivity, we display the title of the placemark only:</p>" ,
     
      "<pre><code>  override fun onMarkerClick(marker: Marker): Boolean {" ,
     
      "    currentTitle.text = marker.title" ,
     
      "    return false" ,
     
      "  }</code></pre>" ,
     
      "<p>How would you go about showing the description + the image as well?</p>" ,
     
      "<p>HINT: What does this code do in the configureMap function:</p>" ,
     
      "<pre><code>      map.addMarker(options).tag = it.id</code></pre>" ,
     
      "<p>How can we use this to realise this feature?</p>" ,
     
      "" 
     
    ]
    }
  
  ]
  }

