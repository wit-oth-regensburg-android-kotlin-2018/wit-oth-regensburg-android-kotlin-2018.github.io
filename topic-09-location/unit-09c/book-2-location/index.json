


  {
  
  
  "type" : "lab",
  "title" : "Lab-09b Tracking",
  "img" : "book-2-location/img/main.png",
  "videoid" : "none",
  "objectives" : "<p>Extend the location facility to track location in real time.</p>",
    
      "properties" : {},
    
    
      "folder" : "book-2-location",
    
    
      "link" : "book-2-location/index.html",
    
  "los": [
     ]
,
  "chapters" : [
  
    {
    "title": " Objectives",
    "shortTitle": "Lab-09b Tracking",
    "content": [
     
      "<h1>Objectives</h1>" ,
     
      "<p>Extend the location facility to track location in real time.</p>" ,
     
      "" 
     
    ],
    "contentMd": [
    
      "# Objectives" ,
    
      "" ,
    
      "Extend the location facility to track location in real time." ,
    
      "" ,
    
      "" 
    
    ]
    },
  
    {
    "title": " Exercise Solution 1",
    "shortTitle": "01",
    "content": [
     
      "<h1>Exercise Solution 1</h1>" ,
     
      "<p>This is the revised view we are seeking:</p>" ,
     
      "<p><img src='img/03x.png' alt=''></p>" ,
     
      "<p>activity_placemark layout to include lat/lng and remove the Set Location button:</p>" ,
     
      "<pre><code>&lt;?xml version=&quot;1.0&quot; encoding=&quot;utf-8&quot;?&gt;" ,
     
      "&lt;android.support.constraint.ConstraintLayout" ,
     
      "  xmlns:android=&quot;http://schemas.android.com/apk/res/android&quot;" ,
     
      "  xmlns:app=&quot;http://schemas.android.com/apk/res-auto&quot;" ,
     
      "  xmlns:tools=&quot;http://schemas.android.com/tools&quot;" ,
     
      "  android:layout_width=&quot;match_parent&quot;" ,
     
      "  android:layout_height=&quot;match_parent&quot;" ,
     
      "  tools:context=&quot;org.wit.placemark.views.placemark.PlacemarkView&quot;&gt;" ,
     
      "" ,
     
      "  &lt;android.support.design.widget.AppBarLayout" ,
     
      "    android:id=&quot;@+id/appBarLayout&quot;" ,
     
      "    android:layout_width=&quot;match_parent&quot;" ,
     
      "    android:layout_height=&quot;wrap_content&quot;" ,
     
      "    android:background=&quot;@color/colorAccent&quot;" ,
     
      "    android:fitsSystemWindows=&quot;true&quot;" ,
     
      "    app:elevation=&quot;0dip&quot;" ,
     
      "    app:theme=&quot;@style/ThemeOverlay.AppCompat.Dark.ActionBar&quot;&gt;" ,
     
      "" ,
     
      "    &lt;android.support.v7.widget.Toolbar" ,
     
      "      android:id=&quot;@+id/toolbarAdd&quot;" ,
     
      "      android:layout_width=&quot;match_parent&quot;" ,
     
      "      android:layout_height=&quot;wrap_content&quot;" ,
     
      "      app:titleTextColor=&quot;@color/colorPrimary&quot; /&gt;" ,
     
      "" ,
     
      "  &lt;/android.support.design.widget.AppBarLayout&gt;" ,
     
      "" ,
     
      "  &lt;android.support.constraint.ConstraintLayout" ,
     
      "    android:layout_width=&quot;match_parent&quot;" ,
     
      "    android:layout_height=&quot;600dp&quot;" ,
     
      "    android:layout_marginEnd=&quot;8dp&quot;" ,
     
      "    android:layout_marginStart=&quot;8dp&quot;" ,
     
      "    app:layout_constraintEnd_toEndOf=&quot;parent&quot;" ,
     
      "    app:layout_constraintStart_toStartOf=&quot;parent&quot;" ,
     
      "    app:layout_constraintTop_toTopOf=&quot;parent&quot;&gt;" ,
     
      "" ,
     
      "    &lt;EditText" ,
     
      "      android:id=&quot;@+id/placemarkTitle&quot;" ,
     
      "      android:layout_width=&quot;239dp&quot;" ,
     
      "      android:layout_height=&quot;wrap_content&quot;" ,
     
      "      android:layout_marginStart=&quot;8dp&quot;" ,
     
      "      android:ems=&quot;10&quot;" ,
     
      "      android:hint=&quot;@string/hint_placemarkTitle&quot;" ,
     
      "      android:inputType=&quot;text&quot;" ,
     
      "      app:layout_constraintBaseline_toBaselineOf=&quot;@+id/textView&quot;" ,
     
      "      app:layout_constraintStart_toStartOf=&quot;parent&quot; /&gt;" ,
     
      "" ,
     
      "    &lt;EditText" ,
     
      "      android:id=&quot;@+id/description&quot;" ,
     
      "      android:layout_width=&quot;239dp&quot;" ,
     
      "      android:layout_height=&quot;wrap_content&quot;" ,
     
      "      android:layout_marginStart=&quot;8dp&quot;" ,
     
      "      android:ems=&quot;10&quot;" ,
     
      "      android:hint=&quot;@string/hint_placemarkDescription&quot;" ,
     
      "      android:inputType=&quot;textPersonName&quot;" ,
     
      "      app:layout_constraintBaseline_toBaselineOf=&quot;@+id/textView2&quot;" ,
     
      "      app:layout_constraintStart_toStartOf=&quot;parent&quot; /&gt;" ,
     
      "" ,
     
      "    &lt;Button" ,
     
      "      android:id=&quot;@+id/chooseImage&quot;" ,
     
      "      android:layout_width=&quot;0dp&quot;" ,
     
      "      android:layout_height=&quot;wrap_content&quot;" ,
     
      "      android:layout_marginStart=&quot;8dp&quot;" ,
     
      "      android:layout_marginEnd=&quot;8dp&quot;" ,
     
      "      android:text=&quot;@string/button_addImage&quot;" ,
     
      "      app:layout_constraintEnd_toEndOf=&quot;parent&quot;" ,
     
      "      app:layout_constraintStart_toStartOf=&quot;parent&quot;" ,
     
      "      app:layout_constraintTop_toBottomOf=&quot;@+id/description&quot; /&gt;" ,
     
      "" ,
     
      "    &lt;ImageView" ,
     
      "      android:id=&quot;@+id/placemarkImage&quot;" ,
     
      "      android:layout_width=&quot;0dp&quot;" ,
     
      "      android:layout_height=&quot;139dp&quot;" ,
     
      "      android:layout_marginStart=&quot;8dp&quot;" ,
     
      "      android:layout_marginTop=&quot;16dp&quot;" ,
     
      "      android:layout_marginEnd=&quot;8dp&quot;" ,
     
      "      app:layout_constraintEnd_toEndOf=&quot;parent&quot;" ,
     
      "      app:layout_constraintHorizontal_bias=&quot;0.0&quot;" ,
     
      "      app:layout_constraintStart_toStartOf=&quot;parent&quot;" ,
     
      "      app:layout_constraintTop_toBottomOf=&quot;@+id/chooseImage&quot;" ,
     
      "      app:srcCompat=&quot;@drawable/ic_launcher_background&quot; /&gt;" ,
     
      "" ,
     
      "    &lt;com.google.android.gms.maps.MapView" ,
     
      "      android:id=&quot;@+id/mapView&quot;" ,
     
      "      android:layout_width=&quot;0dp&quot;" ,
     
      "      android:layout_height=&quot;0dp&quot;" ,
     
      "      android:layout_marginStart=&quot;8dp&quot;" ,
     
      "      android:layout_marginTop=&quot;8dp&quot;" ,
     
      "      android:layout_marginEnd=&quot;8dp&quot;" ,
     
      "      app:layout_constraintBottom_toBottomOf=&quot;parent&quot;" ,
     
      "      app:layout_constraintEnd_toEndOf=&quot;parent&quot;" ,
     
      "      app:layout_constraintStart_toStartOf=&quot;parent&quot;" ,
     
      "      app:layout_constraintTop_toBottomOf=&quot;@+id/placemarkImage&quot; /&gt;" ,
     
      "" ,
     
      "    &lt;TextView" ,
     
      "      android:id=&quot;@+id/textView&quot;" ,
     
      "      android:layout_width=&quot;wrap_content&quot;" ,
     
      "      android:layout_height=&quot;wrap_content&quot;" ,
     
      "      android:layout_marginStart=&quot;8dp&quot;" ,
     
      "      android:text=&quot;Lat:&quot;" ,
     
      "      app:layout_constraintBaseline_toBaselineOf=&quot;@+id/lat&quot;" ,
     
      "      app:layout_constraintStart_toEndOf=&quot;@+id/placemarkTitle&quot; /&gt;" ,
     
      "" ,
     
      "    &lt;TextView" ,
     
      "      android:id=&quot;@+id/textView2&quot;" ,
     
      "      android:layout_width=&quot;wrap_content&quot;" ,
     
      "      android:layout_height=&quot;wrap_content&quot;" ,
     
      "      android:layout_marginStart=&quot;8dp&quot;" ,
     
      "      android:text=&quot;Lng:&quot;" ,
     
      "      app:layout_constraintBaseline_toBaselineOf=&quot;@+id/lng&quot;" ,
     
      "      app:layout_constraintStart_toEndOf=&quot;@+id/description&quot; /&gt;" ,
     
      "" ,
     
      "    &lt;TextView" ,
     
      "      android:id=&quot;@+id/lat&quot;" ,
     
      "      android:layout_width=&quot;wrap_content&quot;" ,
     
      "      android:layout_height=&quot;wrap_content&quot;" ,
     
      "      android:layout_marginStart=&quot;8dp&quot;" ,
     
      "      android:layout_marginTop=&quot;72dp&quot;" ,
     
      "      android:layout_marginEnd=&quot;8dp&quot;" ,
     
      "      android:text=&quot;00.000000&quot;" ,
     
      "      app:layout_constraintEnd_toEndOf=&quot;parent&quot;" ,
     
      "      app:layout_constraintStart_toEndOf=&quot;@+id/textView&quot;" ,
     
      "      app:layout_constraintTop_toTopOf=&quot;parent&quot; /&gt;" ,
     
      "" ,
     
      "    &lt;TextView" ,
     
      "      android:id=&quot;@+id/lng&quot;" ,
     
      "      android:layout_width=&quot;wrap_content&quot;" ,
     
      "      android:layout_height=&quot;wrap_content&quot;" ,
     
      "      android:layout_marginStart=&quot;8dp&quot;" ,
     
      "      android:layout_marginTop=&quot;20dp&quot;" ,
     
      "      android:layout_marginEnd=&quot;8dp&quot;" ,
     
      "      android:text=&quot;00.000000&quot;" ,
     
      "      app:layout_constraintEnd_toEndOf=&quot;parent&quot;" ,
     
      "      app:layout_constraintStart_toEndOf=&quot;@+id/textView2&quot;" ,
     
      "      app:layout_constraintTop_toBottomOf=&quot;@+id/lat&quot; /&gt;" ,
     
      "" ,
     
      "  &lt;/android.support.constraint.ConstraintLayout&gt;" ,
     
      "" ,
     
      "&lt;/android.support.constraint.ConstraintLayout&gt;</code></pre>" ,
     
      "" 
     
    ],
    "contentMd": [
    
      "# Exercise Solution 1" ,
    
      "" ,
    
      "This is the revised view we are seeking:" ,
    
      "" ,
    
      "![](img/03x.png)" ,
    
      "" ,
    
      "activity_placemark layout to include lat/lng and remove the Set Location button:" ,
    
      "" ,
    
      "~~~" ,
    
      "<?xml version='1.0' encoding='utf-8'?>" ,
    
      "<android.support.constraint.ConstraintLayout" ,
    
      "  xmlns:android='http://schemas.android.com/apk/res/android'" ,
    
      "  xmlns:app='http://schemas.android.com/apk/res-auto'" ,
    
      "  xmlns:tools='http://schemas.android.com/tools'" ,
    
      "  android:layout_width='match_parent'" ,
    
      "  android:layout_height='match_parent'" ,
    
      "  tools:context='org.wit.placemark.views.placemark.PlacemarkView'>" ,
    
      "" ,
    
      "  <android.support.design.widget.AppBarLayout" ,
    
      "    android:id='@+id/appBarLayout'" ,
    
      "    android:layout_width='match_parent'" ,
    
      "    android:layout_height='wrap_content'" ,
    
      "    android:background='@color/colorAccent'" ,
    
      "    android:fitsSystemWindows='true'" ,
    
      "    app:elevation='0dip'" ,
    
      "    app:theme='@style/ThemeOverlay.AppCompat.Dark.ActionBar'>" ,
    
      "" ,
    
      "    <android.support.v7.widget.Toolbar" ,
    
      "      android:id='@+id/toolbarAdd'" ,
    
      "      android:layout_width='match_parent'" ,
    
      "      android:layout_height='wrap_content'" ,
    
      "      app:titleTextColor='@color/colorPrimary' />" ,
    
      "" ,
    
      "  </android.support.design.widget.AppBarLayout>" ,
    
      "" ,
    
      "  <android.support.constraint.ConstraintLayout" ,
    
      "    android:layout_width='match_parent'" ,
    
      "    android:layout_height='600dp'" ,
    
      "    android:layout_marginEnd='8dp'" ,
    
      "    android:layout_marginStart='8dp'" ,
    
      "    app:layout_constraintEnd_toEndOf='parent'" ,
    
      "    app:layout_constraintStart_toStartOf='parent'" ,
    
      "    app:layout_constraintTop_toTopOf='parent'>" ,
    
      "" ,
    
      "    <EditText" ,
    
      "      android:id='@+id/placemarkTitle'" ,
    
      "      android:layout_width='239dp'" ,
    
      "      android:layout_height='wrap_content'" ,
    
      "      android:layout_marginStart='8dp'" ,
    
      "      android:ems='10'" ,
    
      "      android:hint='@string/hint_placemarkTitle'" ,
    
      "      android:inputType='text'" ,
    
      "      app:layout_constraintBaseline_toBaselineOf='@+id/textView'" ,
    
      "      app:layout_constraintStart_toStartOf='parent' />" ,
    
      "" ,
    
      "    <EditText" ,
    
      "      android:id='@+id/description'" ,
    
      "      android:layout_width='239dp'" ,
    
      "      android:layout_height='wrap_content'" ,
    
      "      android:layout_marginStart='8dp'" ,
    
      "      android:ems='10'" ,
    
      "      android:hint='@string/hint_placemarkDescription'" ,
    
      "      android:inputType='textPersonName'" ,
    
      "      app:layout_constraintBaseline_toBaselineOf='@+id/textView2'" ,
    
      "      app:layout_constraintStart_toStartOf='parent' />" ,
    
      "" ,
    
      "    <Button" ,
    
      "      android:id='@+id/chooseImage'" ,
    
      "      android:layout_width='0dp'" ,
    
      "      android:layout_height='wrap_content'" ,
    
      "      android:layout_marginStart='8dp'" ,
    
      "      android:layout_marginEnd='8dp'" ,
    
      "      android:text='@string/button_addImage'" ,
    
      "      app:layout_constraintEnd_toEndOf='parent'" ,
    
      "      app:layout_constraintStart_toStartOf='parent'" ,
    
      "      app:layout_constraintTop_toBottomOf='@+id/description' />" ,
    
      "" ,
    
      "    <ImageView" ,
    
      "      android:id='@+id/placemarkImage'" ,
    
      "      android:layout_width='0dp'" ,
    
      "      android:layout_height='139dp'" ,
    
      "      android:layout_marginStart='8dp'" ,
    
      "      android:layout_marginTop='16dp'" ,
    
      "      android:layout_marginEnd='8dp'" ,
    
      "      app:layout_constraintEnd_toEndOf='parent'" ,
    
      "      app:layout_constraintHorizontal_bias='0.0'" ,
    
      "      app:layout_constraintStart_toStartOf='parent'" ,
    
      "      app:layout_constraintTop_toBottomOf='@+id/chooseImage'" ,
    
      "      app:srcCompat='@drawable/ic_launcher_background' />" ,
    
      "" ,
    
      "    <com.google.android.gms.maps.MapView" ,
    
      "      android:id='@+id/mapView'" ,
    
      "      android:layout_width='0dp'" ,
    
      "      android:layout_height='0dp'" ,
    
      "      android:layout_marginStart='8dp'" ,
    
      "      android:layout_marginTop='8dp'" ,
    
      "      android:layout_marginEnd='8dp'" ,
    
      "      app:layout_constraintBottom_toBottomOf='parent'" ,
    
      "      app:layout_constraintEnd_toEndOf='parent'" ,
    
      "      app:layout_constraintStart_toStartOf='parent'" ,
    
      "      app:layout_constraintTop_toBottomOf='@+id/placemarkImage' />" ,
    
      "" ,
    
      "    <TextView" ,
    
      "      android:id='@+id/textView'" ,
    
      "      android:layout_width='wrap_content'" ,
    
      "      android:layout_height='wrap_content'" ,
    
      "      android:layout_marginStart='8dp'" ,
    
      "      android:text='Lat:'" ,
    
      "      app:layout_constraintBaseline_toBaselineOf='@+id/lat'" ,
    
      "      app:layout_constraintStart_toEndOf='@+id/placemarkTitle' />" ,
    
      "" ,
    
      "    <TextView" ,
    
      "      android:id='@+id/textView2'" ,
    
      "      android:layout_width='wrap_content'" ,
    
      "      android:layout_height='wrap_content'" ,
    
      "      android:layout_marginStart='8dp'" ,
    
      "      android:text='Lng:'" ,
    
      "      app:layout_constraintBaseline_toBaselineOf='@+id/lng'" ,
    
      "      app:layout_constraintStart_toEndOf='@+id/description' />" ,
    
      "" ,
    
      "    <TextView" ,
    
      "      android:id='@+id/lat'" ,
    
      "      android:layout_width='wrap_content'" ,
    
      "      android:layout_height='wrap_content'" ,
    
      "      android:layout_marginStart='8dp'" ,
    
      "      android:layout_marginTop='72dp'" ,
    
      "      android:layout_marginEnd='8dp'" ,
    
      "      android:text='00.000000'" ,
    
      "      app:layout_constraintEnd_toEndOf='parent'" ,
    
      "      app:layout_constraintStart_toEndOf='@+id/textView'" ,
    
      "      app:layout_constraintTop_toTopOf='parent' />" ,
    
      "" ,
    
      "    <TextView" ,
    
      "      android:id='@+id/lng'" ,
    
      "      android:layout_width='wrap_content'" ,
    
      "      android:layout_height='wrap_content'" ,
    
      "      android:layout_marginStart='8dp'" ,
    
      "      android:layout_marginTop='20dp'" ,
    
      "      android:layout_marginEnd='8dp'" ,
    
      "      android:text='00.000000'" ,
    
      "      app:layout_constraintEnd_toEndOf='parent'" ,
    
      "      app:layout_constraintStart_toEndOf='@+id/textView2'" ,
    
      "      app:layout_constraintTop_toBottomOf='@+id/lat' />" ,
    
      "" ,
    
      "  </android.support.constraint.ConstraintLayout>" ,
    
      "" ,
    
      "</android.support.constraint.ConstraintLayout>" ,
    
      "~~~" ,
    
      "" ,
    
      "" ,
    
      "" ,
    
      "" 
    
    ]
    },
  
    {
    "title": "# PlacemarkView",
    "shortTitle": "02",
    "content": [
     
      "<h2>PlacemarkView</h2>" ,
     
      "<p>In PlacemarkView, display the lat/lng:</p>" ,
     
      "<h2>PlacemarkView</h2>" ,
     
      "<pre><code>  override fun showPlacemark(placemark: PlacemarkModel) {" ,
     
      "    placemarkTitle.setText(placemark.title)" ,
     
      "    description.setText(placemark.description)" ,
     
      "    placemarkImage.setImageBitmap(readImageFromPath(this, placemark.image))" ,
     
      "    if (placemark.image != null) {" ,
     
      "      chooseImage.setText(R.string.change_placemark_image)" ,
     
      "    }" ,
     
      "    lat.setText(&quot;%.6f&quot;.format(placemark.lat))" ,
     
      "    lng.setText(&quot;%.6f&quot;.format(placemark.lng))" ,
     
      "  }</code></pre>" ,
     
      "<p>Also in PlacemarkView - remove references to the setLocation button:</p>" ,
     
      "<pre><code>   // placemarkLocation.setOnClickListener { presenter.doSetLocation() }</code></pre>" ,
     
      "<p>Instead, set an onClikcListener on the GoogleMap object:</p>" ,
     
      "<pre><code>    mapView.getMapAsync {" ,
     
      "      presenter.doConfigureMap(it)" ,
     
      "      it.setOnMapClickListener { presenter.doSetLocation() }" ,
     
      "    }</code></pre>" ,
     
      "" 
     
    ],
    "contentMd": [
    
      "## PlacemarkView" ,
    
      "" ,
    
      "In PlacemarkView, display the lat/lng:" ,
    
      "" ,
    
      "## PlacemarkView" ,
    
      "" ,
    
      "~~~" ,
    
      "  override fun showPlacemark(placemark: PlacemarkModel) {" ,
    
      "    placemarkTitle.setText(placemark.title)" ,
    
      "    description.setText(placemark.description)" ,
    
      "    placemarkImage.setImageBitmap(readImageFromPath(this, placemark.image))" ,
    
      "    if (placemark.image != null) {" ,
    
      "      chooseImage.setText(R.string.change_placemark_image)" ,
    
      "    }" ,
    
      "    lat.setText('%.6f'.format(placemark.lat))" ,
    
      "    lng.setText('%.6f'.format(placemark.lng))" ,
    
      "  }" ,
    
      "~~~" ,
    
      "" ,
    
      "Also in PlacemarkView - remove references to the setLocation button:" ,
    
      "" ,
    
      "~~~" ,
    
      "   // placemarkLocation.setOnClickListener { presenter.doSetLocation() }" ,
    
      "~~~" ,
    
      "" ,
    
      "Instead, set an onClikcListener on the GoogleMap object:" ,
    
      "" ,
    
      "~~~" ,
    
      "    mapView.getMapAsync {" ,
    
      "      presenter.doConfigureMap(it)" ,
    
      "      it.setOnMapClickListener { presenter.doSetLocation() }" ,
    
      "    }" ,
    
      "~~~" ,
    
      "" ,
    
      "" ,
    
      "" 
    
    ]
    },
  
    {
    "title": " Live Location Updates",
    "shortTitle": "03",
    "content": [
     
      "<h1>Live Location Updates</h1>" ,
     
      "<p>First, we need a new helper function:</p>" ,
     
      "<h2>LocationHelper</h2>" ,
     
      "<pre><code>@SuppressLint(&quot;RestrictedApi&quot;)" ,
     
      "fun createDefaultLocationRequest() : LocationRequest {" ,
     
      "  val locationRequest = LocationRequest().apply {" ,
     
      "    interval = 10000" ,
     
      "    fastestInterval = 5000" ,
     
      "    priority = LocationRequest.PRIORITY_HIGH_ACCURACY" ,
     
      "  }" ,
     
      "  return locationRequest" ,
     
      "}</code></pre>" ,
     
      "<p>In PlacemarkPresenter, use this helper to initialise a new attribute:</p>" ,
     
      "<pre><code>  val locationRequest = createDefaultLocationRequest()</code></pre>" ,
     
      "<p>Now introduce a new method, also in the presenter:</p>" ,
     
      "<h2>PlacemarkPresenter</h2>" ,
     
      "<pre><code>  @SuppressLint(&quot;MissingPermission&quot;)" ,
     
      "  fun doResartLocationUpdates() {" ,
     
      "    var locationCallback = object : LocationCallback() {" ,
     
      "      override fun onLocationResult(locationResult: LocationResult?) {" ,
     
      "        if (locationResult != null &amp;&amp; locationResult.locations != null) {" ,
     
      "          val l = locationResult.locations.last()" ,
     
      "          locationUpdate(l.latitude, l.longitude)" ,
     
      "        }" ,
     
      "      }" ,
     
      "    }" ,
     
      "    if (!edit) {" ,
     
      "      locationService.requestLocationUpdates(locationRequest, locationCallback, null)" ,
     
      "    }" ,
     
      "  }</code></pre>" ,
     
      "<p>This method, when invoked, does 12 things:</p>" ,
     
      "<ul>" ,
     
      "<li>defines a callback - to be triggered when we turn location updates</li>" ,
     
      "<li>checks to see if we are in edit mode - if not, it is assumed we would like live location updates to commence.</li>" ,
     
      "</ul>" ,
     
      "<p>Finally, we need to be careful how we start these location updates. The safest place is from the PresenterView:</p>" ,
     
      "<h2>PlacemarkView</h2>" ,
     
      "<pre><code>  override fun onResume() {" ,
     
      "    super.onResume()" ,
     
      "    mapView.onResume()" ,
     
      "    presenter.doResartLocationUpdates()" ,
     
      "  }</code></pre>" ,
     
      "<p>Here, in onResumne(), we ask for location updates to start (or restart if the view has been removed). We are assuming that location updates will be automatically terminated if the view is destroyed.</p>" ,
     
      "<p>Run the app now in the simulator - and modify the lat/log values, then pressing <code>Send</code>. The location should change reasonably promptly in the view.</p>" ,
     
      "" 
     
    ],
    "contentMd": [
    
      "# Live Location Updates" ,
    
      "" ,
    
      "First, we need a new helper function:" ,
    
      "" ,
    
      "## LocationHelper" ,
    
      "" ,
    
      "~~~" ,
    
      "@SuppressLint('RestrictedApi')" ,
    
      "fun createDefaultLocationRequest() : LocationRequest {" ,
    
      "  val locationRequest = LocationRequest().apply {" ,
    
      "    interval = 10000" ,
    
      "    fastestInterval = 5000" ,
    
      "    priority = LocationRequest.PRIORITY_HIGH_ACCURACY" ,
    
      "  }" ,
    
      "  return locationRequest" ,
    
      "}" ,
    
      "~~~" ,
    
      "" ,
    
      "In PlacemarkPresenter, use this helper to initialise a new attribute:" ,
    
      "" ,
    
      "~~~" ,
    
      "  val locationRequest = createDefaultLocationRequest()" ,
    
      "~~~" ,
    
      "" ,
    
      "" ,
    
      "Now introduce a new method, also in the presenter:" ,
    
      "" ,
    
      "## PlacemarkPresenter" ,
    
      "" ,
    
      "~~~" ,
    
      "  @SuppressLint('MissingPermission')" ,
    
      "  fun doResartLocationUpdates() {" ,
    
      "    var locationCallback = object : LocationCallback() {" ,
    
      "      override fun onLocationResult(locationResult: LocationResult?) {" ,
    
      "        if (locationResult != null && locationResult.locations != null) {" ,
    
      "          val l = locationResult.locations.last()" ,
    
      "          locationUpdate(l.latitude, l.longitude)" ,
    
      "        }" ,
    
      "      }" ,
    
      "    }" ,
    
      "    if (!edit) {" ,
    
      "      locationService.requestLocationUpdates(locationRequest, locationCallback, null)" ,
    
      "    }" ,
    
      "  }" ,
    
      "~~~" ,
    
      "" ,
    
      "This method, when invoked, does 12 things:" ,
    
      "" ,
    
      "- defines a callback - to be triggered when we turn location updates" ,
    
      "- checks to see if we are in edit mode - if not, it is assumed we would like live location updates to commence." ,
    
      "" ,
    
      "Finally, we need to be careful how we start these location updates. The safest place is from the PresenterView:" ,
    
      "" ,
    
      "## PlacemarkView" ,
    
      "" ,
    
      "~~~" ,
    
      "  override fun onResume() {" ,
    
      "    super.onResume()" ,
    
      "    mapView.onResume()" ,
    
      "    presenter.doResartLocationUpdates()" ,
    
      "  }" ,
    
      "~~~" ,
    
      "" ,
    
      "Here, in onResumne(), we ask for location updates to start (or restart if the view has been removed). We are assuming that location updates will be automatically terminated if the view is destroyed." ,
    
      "" ,
    
      "Run the app now in the simulator - and modify the lat/log values, then pressing `Send`. The location should change reasonably promptly in the view." ,
    
      "" ,
    
      "" 
    
    ]
    },
  
    {
    "title": " Exercises",
    "shortTitle": "Exercises",
    "content": [
     
      "<h1>Exercises</h1>" ,
     
      "<p>Placemark application so far:</p>" ,
     
      "<ul>" ,
     
      "<li><a href='archives/archive.zip'>archive.zip</a></li>" ,
     
      "</ul>" ,
     
      "<p>This is a revised EditLocation view:</p>" ,
     
      "<p><img src='img/02.png' alt=''></p>" ,
     
      "<p>In this version, as you drag the marker around the lat/long is updated as the marker is moved. Try to implement this now. </p>" ,
     
      "<p>One strategy might be to replace the existing view completely with a version that loads a new layout. This layout can be designed in the layout editor, and contain the MapView + the lat/lng text views.</p>" ,
     
      "<p>To kick start this process, you could copy the PlacemarkMapView class + layout. You should be able to keep the same presenter.</p>" ,
     
      "" 
     
    ],
    "contentMd": [
    
      "# Exercises" ,
    
      "" ,
    
      "Placemark application so far:" ,
    
      "" ,
    
      "- [archive.zip](archives/archive.zip)" ,
    
      "" ,
    
      "" ,
    
      "This is a revised EditLocation view:" ,
    
      "" ,
    
      "![](img/02.png)" ,
    
      "" ,
    
      "In this version, as you drag the marker around the lat/long is updated as the marker is moved. Try to implement this now. " ,
    
      "" ,
    
      "One strategy might be to replace the existing view completely with a version that loads a new layout. This layout can be designed in the layout editor, and contain the MapView + the lat/lng text views." ,
    
      "" ,
    
      "To kick start this process, you could copy the PlacemarkMapView class + layout. You should be able to keep the same presenter." 
    
    ]
    }
  
  ]
  }

